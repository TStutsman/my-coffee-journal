import { CoffeeListItem, CoffeeForm } from "@coffees";
import { useStore, useModal } from '@context';
import { useState, useEffect } from "react";
import './CoffeeList.css';

function CoffeeList(){
    const { coffees, fetchCoffees } = useStore();
    const { setOnModalClose, setModalContent } = useModal();
    const [focusedCoffee, setFocusedCoffee] = useState(0);

    const addNewCoffee = () => {
        setOnModalClose(() => fetchCoffees);
        setModalContent(<CoffeeForm/>);
    }

    useEffect(() => {
        fetchCoffees();
    }, [fetchCoffees]);

    return (
        <>
        <div className="coffee-list">
            { coffees.map((coffee, index) => (
                <CoffeeListItem 
                    key={coffee.id} 
                    coffee={coffee} 
                    show={focusedCoffee == index} 
                    focusCoffee={() => setFocusedCoffee(index)}
                />
            ))}
        </div>
        <button id="add-coffee" onClick={addNewCoffee}>
            <svg id='new-coffee-icon' height="100%" version="1.1" viewBox="0 0 160.504 177.042" width="100%" fill='currentColor'><path d="M103.719 1C78.603 0.730259 50.1934 13.8798 28.5625 38.3438C-5.27769 76.6161-9.66725 128.033 18.7812 153.188C19.6775 153.98 20.6549 154.59 21.5938 155.312C23.07 156.064 24.3406 154.697 24.9375 153.312C26.3688 149.997 25.1963 148.639 35.6562 127.094C54.9082 87.4361 81.2886 76.9427 98.0938 59.0938C114.312 41.8691 118.151 33.0539 128.375 9.59375C128.724 8.79277 128.788 6.64817 127.344 5.8125C120.075 2.66805 112.091 1.08991 103.719 1ZM140.344 16C139.061 15.9925 137.824 16.3828 137.156 17.4062C134.777 21.0512 134.267 24.616 122.812 43.7812C110.857 63.7851 99.3715 71.7034 76.1562 92.375C53.1431 112.867 36.1984 149.743 37.8125 160.594C38.0367 162.1 39.9743 164.317 41.4062 164.812C58.7451 169.155 79.0584 165.843 98.1875 155.812L98.25 138.594L74.6875 138.594C70.2275 138.594 66.625 134.43 66.625 129.969L66.625 121.188C66.625 116.728 70.1963 112.344 74.6562 112.344L97.3125 112.344L97.3125 89.0938C97.3125 84.6322 101.851 81 106.312 81L115 81C119.46 81 123.688 84.6322 123.688 89.0938L123.844 112.375L144.156 112.406C165.137 78.321 165.6 39.1062 143.719 17C142.93 16.3977 141.627 16.0075 140.344 16Z"/><path d="M107.327 85.1169C103.902 85.1169 101.113 87.9065 101.113 91.3313L101.113 116.047L76.3966 116.047C72.973 116.047 70.2302 118.79 70.2302 122.214L70.2302 128.938C70.2302 132.363 72.973 135.106 76.3966 135.106L101.113 135.106L101.113 159.822C101.113 163.245 103.902 166.035 107.327 166.035L114.005 166.035C117.428 166.035 120.218 163.245 120.218 159.822L120.218 135.106L144.887 135.106C148.312 135.106 151.102 132.363 151.102 128.938L151.102 122.214C151.102 118.79 148.312 116.047 144.887 116.047L120.218 116.047L120.218 91.3313C120.218 87.9065 117.428 85.1169 114.005 85.1169L107.327 85.1169Z" fill="currentColor"/></svg>
        </button>
        </>
    );
}

export default CoffeeList;