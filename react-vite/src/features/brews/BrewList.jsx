import { BrewListItem, BrewForm } from "@brews";
import { useStore, useModal } from '@context';
import { useEffect, useState } from "react";
import './BrewList.css';

function BrewList(){
    const { brews, fetchBrews } = useStore();
    const { setOnModalClose, setModalContent } = useModal();
    const [focusedBrew, setFocusedBrew] = useState(-1);

    useEffect(() => {
        fetchBrews();
    }, [fetchBrews]);

    const addNewBrew = () => {
        setOnModalClose(() => fetchBrews);
        setModalContent(<BrewForm/>);
    }

    return (
        <>
        <div className="brew-list">
            { brews.map((brew, index) => (
                <BrewListItem 
                    key={brew.id} 
                    brew={brew} 
                    show={focusedBrew == index}
                    focusBrew={() => setFocusedBrew(index)}
                />
            ))}
        </div>
        <button id="add-brew" onClick={addNewBrew}>
            <svg className='new-brew-icon' height="100%" version="1.1" viewBox="3.05618 7.4375 612.116 488.562" width="100%" fill='currentColor'><path d="M260.812 7.4375L12.8125 8.03125C12.8125 8.03125 6.56364 8.2556 4.21875 10.9062C1.95717 13.4627 3.56749 18.4265 4.28125 20.5C4.68558 21.6747 6.75129 31.9889 14.625 46.6562C21.37 59.2209 34.5065 74.8762 44.9375 93.875C52.2215 107.141 54.5648 124.407 62.9062 139.5C71.3699 154.814 83.0794 168.205 92 184.281C100.995 200.49 106.439 220.449 115.25 236.281C123.185 250.54 133.967 260.279 141.25 273.344C149.558 288.245 152.64 305.796 159.438 317.969C176.298 348.166 190.656 364.688 190.656 364.688C190.656 364.688 171.67 389.22 154.656 394.75C137.642 400.279 35.8279 402.305 31.2188 405.312C26.6097 408.321 24.3081 414.412 24.125 418.531C23.9418 422.651 27.9209 431.08 35.9375 433C71.5961 441.537 163.902 448.044 212 448.969C260.098 449.894 262.25 449.625 262.25 449.625L262.25 449.656C262.25 449.656 266.246 449.894 314.344 448.969C333.483 448.601 359.866 447.164 386.656 445.25C386.656 420.587 386.656 397.987 386.656 397.188C383.369 396.817 380.693 396.41 378.25 396L326.656 396C286.656 396 266.656 376 266.656 336C266.656 296 286.656 276 326.656 276L383.844 276C384.29 275.125 384.615 274.202 385.094 273.344C385.573 272.485 386.15 271.709 386.656 270.875L386.656 216C386.656 176 406.656 156 446.656 156C448.779 156 450.615 156.294 452.625 156.406C456.458 150.869 460.212 145.337 463.438 139.5C471.779 124.407 474.122 107.141 481.406 93.875C489.754 78.67 499.664 65.7082 506.812 54.6562C506.812 54.6586 506.75 54.8438 506.75 54.8438C506.75 54.8438 530.753 49.6955 549.875 49.1562C556.249 48.9766 562.093 49.2921 566.312 50.5C583.189 55.3321 600.178 74.5296 599.125 98.2188C598.046 122.522 575.041 149.541 528.562 174.812C518.913 180.059 510.515 184.32 502.375 188.406C504.04 193.01 505.161 198.163 505.844 203.75C529.133 193.041 575.214 163.818 592 145.438C604.244 132.029 614.646 117.774 615.156 96.1562C615.614 76.7974 606.01 54.9808 592.062 45.8125C578.115 36.6442 563.465 34.768 549.656 34.5625C535.848 34.357 521.419 34.7186 518.344 32.5938C518.285 32.5532 518.188 32.5842 518.125 32.5625C520.698 25.8318 521.81 21.2353 522.062 20.5C522.777 18.4265 524.387 13.4627 522.125 10.9062C519.78 8.2556 513.531 8.03125 513.531 8.03125L260.812 7.4375Z"/><path d="M406.646 213.962L406.646 296L324.608 296C303.642 296 286.646 312.996 286.646 333.962L286.646 338.038C286.646 359.004 303.642 376 324.608 376L406.646 376L406.646 458.038C406.646 479.004 423.642 496 444.608 496L448.684 496C469.65 496 486.646 479.004 486.646 458.038L486.646 376L568.684 376C589.65 376 606.646 359.004 606.646 338.038L606.646 333.962C606.646 312.996 589.65 296 568.684 296L486.646 296L486.646 213.962C486.646 192.996 469.65 176 448.684 176L444.608 176C423.642 176 406.646 192.996 406.646 213.962Z"/></svg>
        </button>
        </>
    );
}

export default BrewList;